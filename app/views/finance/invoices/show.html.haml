- title t('.title', number: @invoice.number)

- total = 0

%p
  %b= heading_helper(Invoice, :created_at) + ':'
  = format_time(@invoice.created_at)
%p
  %b= heading_helper(Invoice, :created_by) + ':'
  = show_user(@invoice.created_by)
%p
  %b= heading_helper(Invoice, :supplier) + ':'
  = @invoice.supplier.name

- if @invoice.deliveries.count > 0
  %p
    %b= heading_helper(Invoice, :deliveries) + ':'
    %span><
      - @invoice.deliveries.order(:delivered_on).each_with_index do |delivery, index|
        - sum = delivery.sum
        - total += sum
        = ', ' if index > 0
        = link_to format_date(delivery.delivered_on), [delivery.supplier,delivery]
        = ' (' + number_to_currency(sum) + ')'
- if @invoice.orders.count > 0
  %p
    %b= heading_helper(Invoice, :orders) + ':'
    %span><
      - @invoice.orders.order(:ends).each_with_index do |order, index|
        - sum = order.sum
        - total += sum
        = ', ' if index > 0
        = link_to format_date(order.ends), new_finance_order_path(order_id: order)
        = ' (' + number_to_currency(sum) + ')'

%p
  %b= heading_helper(Invoice, :number) + ':'
  = @invoice.number
%p
  %b= heading_helper(Invoice, :date) + ':'
  = @invoice.date
%p
  %b= heading_helper(Invoice, :paid_on) + ':'
  = @invoice.paid_on
%p
  %b= heading_helper(Invoice, :amount) + ':'
  = number_to_currency @invoice.amount
%p
  %b= heading_helper(Invoice, :deposit) + ':'
  = number_to_currency @invoice.deposit
%p
  %b= heading_helper(Invoice, :deposit_credit) + ':'
  = number_to_currency @invoice.deposit_credit
%p
  %b= heading_helper(Invoice, :net_amount) + ':'
  = number_to_currency @invoice.net_amount
- if @invoice.deliveries.count + @invoice.orders.count > 0
  %p
    %b= heading_helper(Invoice, :total) + ':'
    = number_to_currency total
%p
  %b= heading_helper(Invoice, :attachment) + ':'
  - if @invoice.attachment_data
    = link_to t('ui.download'), finance_invoice_attachment_path(@invoice)
%p
  %b= heading_helper(Invoice, :note) + ':'
  =h @invoice.note

- if @invoice.money_transfer
  %hr
  - if @invoice.money_transfer.bank_transactions.count > 0
    %h3= t('.related_bank_transactions')
    %table.table.table-striped
      %thead
        %tr
          %th= heading_helper BankTransaction, :booking_date
          %th= heading_helper BankTransaction, :text
          %th= heading_helper BankTransaction, :reference
          %th= heading_helper BankTransaction, :amount
      %tbody
        - @invoice.money_transfer.bank_transactions.each do |t|
          %tr
            %td= link_to format_date(t.booking_date), finance_bank_transaction_path(t)
            %td= t.text
            %td= t.reference
            %td.currency{:style => "color:#{t.amount < 0 ? 'red' : 'black'}; width:5em"}= number_to_currency(t.amount)
  - if @invoice.money_transfer.financial_transactions.count > 0
    %h3= t('.related_financial_transactions')
    %table.table.table-striped
      %thead
        %tr
          %th= heading_helper FinancialTransaction, :created_on
          %th= heading_helper FinancialTransaction, :ordergroup
          %th= heading_helper FinancialTransaction, :note
          %th.numeric= heading_helper FinancialTransaction, :amount
      %tbody
        - @invoice.money_transfer.financial_transactions.each do |ft|
          %tr
            %td= format_date(ft.created_on)
            %td= link_to h(ft.ordergroup.name), finance_ordergroup_transactions_path(ft.ordergroup)
            %td= ft.note
            %td.numeric{:style => "color:#{ft.amount < 0 ? 'red' : 'black'}"}= number_to_currency(ft.amount)

- if @invoice.user_can_edit?(current_user)
  = link_to t('ui.edit'), edit_finance_invoice_path(@invoice), class: 'btn'
= link_to t('ui.or_cancel'), finance_invoices_path

%section
  %h2= t '.title'
  - if ordergroup.not_enough_apples?
    .alert
      = t '.not_enough_apples'
  - unless Order.open.empty?
    %table.table.table-striped
      %thead
        %tr
          %th{'style' => 'width: 10%'}= t '.supplier'
          %th{'style' => 'width: 35%'}= t '.order_note'
          %th{'style' => 'width: 20%'}= t '.ending'
          %th{'style' => 'width: 20%'}= t '.who_ordered'
          %th{'style' => 'width: 5%'}= t '.total'
      %tbody
        - total = 0
        - Order.open.each do |order|
          %tr
            %td= link_to_ordering(order)
            - # display order note. If longer then specified in config create 
            - # preview text and collapseable with label
            %td
              - # @todo: i'm not able to get new vars from app_config read by ruby. 
              - #        var 'order_note_length' is there but here i get just NIL
              - max_length = 60 #(Integer(FoodsoftConfig.config[:order_note_length])
              - if order.note.length > max_length
                - order_note_preview = truncate(order.note, :length => max_length, :separator => ' ')
                - order_note_content = order.note
                %span= order_note_preview
                - # @todo: click-me class does not work (main.sass seems not to be loaded)
                %div{'data-toggle'=>"collapse", 'data-target'=>"#more-order-note-#{order.id}", 'class' => 'label label-info click-me'}= t '.show_full_comment'
                %div{'id'=>"more-order-note-#{order.id}", 'class'=>"collapse out"}
                  %hr
                    %span= order_note_content
              - else
                %span= order.note
              
            %td= format_time(order.ends) unless order.ends.nil?
            - if group_order = order.group_order(ordergroup)
              - total += group_order.price
              %td= "#{group_order.updated_by.nick} (#{format_time(group_order.updated_on)})"
              %td.numeric= number_to_currency(group_order.price)
            - else
              %td{:colspan => 2}
      - if total > 0
        %tfooter
          %tr
            %th(colspan="3")
            %th= t('.total_sum') + ':'
            %th.numeric= number_to_currency(total)
  - else
    %i= t '.no_open_orders'
